{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/auth/index.js","webpack:///./src/auth/router.js","webpack:///./src/auth/store.js","webpack:///./src/hotels/index.js","webpack:///./src/hotels/router.js","webpack:///./src/hotels/store.js","webpack:///./src/index.js","webpack:///./src/utils/constants.js","webpack:///./src/utils/index.js","webpack:///./src/utils/middlewares.js","webpack:///./src/utils/wss.js","webpack:///external \"fs\"","webpack:///external \"http\"","webpack:///external \"jsonwebtoken\"","webpack:///external \"koa\"","webpack:///external \"koa-bodyparser\"","webpack:///external \"koa-cors\"","webpack:///external \"koa-jwt\"","webpack:///external \"koa-router\"","webpack:///external \"nedb-promise\"","webpack:///external \"ws\""],"names":["router","Router","createToken","user","jwt","sign","username","_id","jwtConfig","secret","expiresIn","createUser","response","userStore","insert","body","token","status","err","issue","error","message","post","ctx","request","credentials","findOne","password","UserStore","constructor","filename","autoload","store","dataStore","props","get","userId","state","name","params","arr","all","hotelStore","find","hotel","toLowerCase","includes","concat","id","createHotel","broadcast","type","payload","photo","data","buff","Buffer","from","fs","writeFile","console","log","put","hotelId","updatedCount","update","del","remove","HotelStore","hotelText","Error","Koa","require","app","server","createServer","callback","WebSocket","wss","Server","cors","bodyparser","timingLogger","exceptionHandler","initWss","use","prefix","publicApiRouter","authRouter","routes","allowedMethods","protectedApiRouter","mealRouter","listen","next","start","Date","ms","method","url","value","on","ws","JSON","parse","close","verify","clients","forEach","client","readyState","OPEN","send","stringify"],"mappings":"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","file":"main.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n","export * from './router';","import Router from 'koa-router';\nimport userStore from './store';\nimport jwt from 'jsonwebtoken';\nimport { jwtConfig } from '../utils';\n\nexport const router = new Router();\n\nconst createToken = (user) => {\n    return jwt.sign({ username: user.username, _id: user._id }, jwtConfig.secret, { expiresIn: 60 * 60 * 60 });\n};\n\nconst createUser = async (user, response) => {\n    try {\n        await userStore.insert(user);\n        response.body = { token: createToken(user) };\n        response.status = 201; // created\n    } catch (err) {\n        response.body = { issue: [{ error: err.message }] };\n        response.status = 400; // bad request\n    }\n};\n\nrouter.post('/signup', async (ctx) => await createUser(ctx.request.body, ctx.response));\n\nrouter.post('/login', async (ctx) => {\n    const credentials = ctx.request.body;\n    const response = ctx.response;\n    const user = await userStore.findOne({ username: credentials.username });\n    if (user && credentials.password === user.password) {\n        response.body = { token: createToken(user) };\n        response.status = 201; // created\n    } else {\n        response.body = { issue: [{ error: 'Invalid credentials' }] };\n        response.status = 400; // bad request\n    }\n});\n","import dataStore from 'nedb-promise';\n\nexport class UserStore {\n    constructor({ filename, autoload }) {\n        this.store = dataStore({ filename, autoload });\n    }\n\n    async findOne(props) {\n        return this.store.findOne(props);\n    }\n\n    async insert(user) {\n        //\n        return this.store.insert(user);\n    };\n}\n\nexport default new UserStore({ filename: './db/users.json', autoload: true });","export * from './router';","import Router from 'koa-router';\nimport { broadcast } from \"../utils\";\nimport hotelStore from './store';\nimport fs from \"fs\";\n\nexport const router = new Router();\n\nrouter.get('/filter/:name?', async (ctx) => {\n    const response = ctx.response;\n    const userId = ctx.state.user._id;\n    let name = ctx.params.name;\n    if (!name)\n        name = ''\n    let arr = []\n    let all = await hotelStore.find({ userId })\n    for (let hotel of all)\n        if (hotel.name.toLowerCase().includes(name.toLowerCase()))\n            arr = arr.concat(hotel)\n    response.body = arr;\n    response.status = 200; // ok\n});\n\nrouter.get('/:id', async (ctx) => {\n    const userId = ctx.state.user._id;\n    const hotel = await hotelStore.findOne({ _id: ctx.params.id });\n    const response = ctx.response;\n    if (hotel) {\n        if (hotel.userId === userId) {\n            response.body = hotel;\n            response.status = 200; // ok\n        } else {\n            response.status = 403; // forbidden\n        }\n    } else {\n        response.status = 404; // not found\n    }\n});\n\nconst createHotel = async (ctx, hotel, response) => {\n    try {\n        const userId = ctx.state.user._id;\n        hotel.userId = userId;\n        response.body = await hotelStore.insert(hotel);\n        response.status = 201; // created\n        broadcast(userId, { type: 'created', payload: response.body });\n    } catch (err) {\n        response.body = { message: err.message };\n        response.status = 400; // bad request\n    }\n};\n\nrouter.post('/', async ctx => await createHotel(ctx, ctx.request.body, ctx.response));\n\nrouter.post('/photo', async ctx => {\n    // noinspection JSUnresolvedVariable\n    const photo = ctx.request.body.data;\n    let buff = Buffer.from(photo, 'base64');\n    fs.writeFile('my-file.png', buff, (err) => {\n        if (err) throw err;\n        console.log('The binary data has been decoded and saved to my-file.png');\n    });\n    ctx.response.status = 200\n})\n\nrouter.put('/:id', async (ctx) => {\n    const hotel = ctx.request.body;\n    const id = ctx.params.id;\n    const hotelId = hotel._id;\n    const response = ctx.response;\n    if (hotelId && hotelId !== id) {\n        response.body = { message: 'Param id and body _id should be the same' };\n        response.status = 400; // bad request\n        return;\n    }\n    if (!hotelId) {\n        await createHotel(ctx, hotel, response);\n    } else {\n        const userId = ctx.state.user._id;\n        hotel.userId = userId;\n        const updatedCount = await hotelStore.update({ _id: id }, hotel);\n        if (updatedCount === 1) {\n            response.body = hotel;\n            response.status = 200; // ok\n            broadcast(userId, { type: 'updated', payload: hotel });\n        } else {\n            response.body = { message: 'Resource no longer exists' };\n            response.status = 405; // method not allowed\n        }\n    }\n});\n\nrouter.del('/:id', async (ctx) => {\n    const userId = ctx.state.user._id;\n    const hotel = await hotelStore.findOne({ _id: ctx.params.id });\n    if (hotel && userId !== hotel.userId) {\n        ctx.response.status = 403; // forbidden\n    } else {\n        await hotelStore.remove({ _id: ctx.params.id });\n        ctx.response.status = 204; // no content\n    }\n});\n","import dataStore from 'nedb-promise';\n\nexport class HotelStore {\n    constructor({ filename, autoload }) {\n        this.store = dataStore({ filename, autoload });\n    }\n\n    async find(props) {\n        return this.store.find(props);\n    }\n\n    async findOne(props) {\n        return this.store.findOne(props);\n    }\n\n    async insert(hotel) {\n        let hotelText = hotel.name;\n        if (!hotelText) { // validation\n            throw new Error('Missing text property')\n        }\n        return this.store.insert(hotel);\n    };\n\n    async update(props, hotel) {\n        return this.store.update(props, hotel);\n    }\n\n    async remove(props) {\n        return this.store.remove(props);\n    }\n}\n\nexport default new HotelStore({ filename: './db/hotels.json', autoload: true });","import {jwtConfig} from \"./utils\";\n\nconst Koa = require('koa');\nconst app = new Koa();\nconst server = require('http').createServer(app.callback());\nconst WebSocket = require('ws');\nconst wss = new WebSocket.Server({server});\nconst Router = require('koa-router');\nconst cors = require('koa-cors');\nconst bodyparser = require('koa-bodyparser');\nconst {timingLogger, exceptionHandler, initWss} = require(\"./utils\");\nimport { router as mealRouter } from './hotels';\nimport { router as authRouter } from './auth';\nimport jwt from 'koa-jwt';\n\ninitWss(wss);\n\napp.use(bodyparser());\napp.use(cors());\napp.use(timingLogger);\napp.use(exceptionHandler);\n\nconst prefix = '/api';\n\n// public\nconst publicApiRouter = new Router({ prefix });\npublicApiRouter\n    .use('/auth', authRouter.routes());\napp\n    .use(publicApiRouter.routes())\n    .use(publicApiRouter.allowedMethods());\n\napp.use(jwt(jwtConfig));\n\n// protected\nconst protectedApiRouter = new Router({ prefix });\nprotectedApiRouter\n    .use('/hotel', mealRouter.routes());\napp\n    .use(protectedApiRouter.routes())\n    .use(protectedApiRouter.allowedMethods());\n\nserver.listen(3000);\nconsole.log('started on port 3000');\n","export const jwtConfig = { secret: 'my-secret' };\n","export * from './constants';\nexport * from './middlewares';\nexport * from './wss';\n","export const timingLogger = async (ctx, next) => {\n    const start = new Date();\n    await next();\n    const ms = new Date() - start;\n    console.log(`${ctx.method} ${ctx.url} ${ctx.response.status} - ${ms}ms`);\n}\n\nexport const exceptionHandler = async (ctx, next) => {\n    try {\n        return await next();\n    } catch (err) {\n        console.log(err)\n        ctx.response.body = {issue: [{error: err.message || 'Unexpected error'}]};\n        ctx.response.status = 500;\n    }\n}\n","import jwt from \"jsonwebtoken\";\nimport { jwtConfig } from \"./constants\";\n\nconst WebSocket = require(\"ws\");\n\nlet wss;\n\nexport const initWss = value => {\n    wss = value;\n    wss.on('connection', ws => {\n        ws.on('message', message => {\n            const { type, payload: { token } } = JSON.parse(message);\n            if (type !== 'authorization') {\n                ws.close();\n                return;\n            }\n            try {\n                ws.user = jwt.verify(token, jwtConfig.secret);\n            } catch (err) {\n                ws.close();\n            }\n        })\n    });\n};\n\nexport const broadcast = (userId, data) => {\n    if (!wss) {\n        return;\n    }\n    wss.clients.forEach(client => {\n        if (client.readyState === WebSocket.OPEN && userId === client.user._id) {\n            console.log(`broadcast sent to ${client.user.username}`);\n            client.send(JSON.stringify(data));\n        }\n    });\n};\n","module.exports = require(\"fs\");","module.exports = require(\"http\");","module.exports = require(\"jsonwebtoken\");","module.exports = require(\"koa\");","module.exports = require(\"koa-bodyparser\");","module.exports = require(\"koa-cors\");","module.exports = require(\"koa-jwt\");","module.exports = require(\"koa-router\");","module.exports = require(\"nedb-promise\");","module.exports = require(\"ws\");"],"sourceRoot":""}